<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum State Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #E0E0E0;
        }
        .nvidia-green { color: #76B900; }
        .bg-nvidia-green { background-color: #76B900; }
        .border-nvidia-green { border-color: #76B900; }
        
        .info-box {
            background-color: #1F1F1F;
            border-radius: 0.5rem;
            padding: 1.25rem;
            border: 1px solid #333;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }
        
        canvas {
            display: block;
            width: 100% !important;
            height: 100% !important;
            outline: none;
        }

        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: #444;
            border-radius: 3px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #76B900;
            cursor: pointer;
            margin-top: -6px;
            border: 2px solid #fff;
            box-shadow: 0 0 10px rgba(118, 185, 0, 0.5);
        }

        /* Toggle Switch Styling */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #76B900;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #76B900;
        }

        /* Bar Transition */
        .hist-bar { transition: height 0.15s ease-out; }

        /* Bitstream animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .bit-result { animation: fadeIn 0.2s ease-out forwards; }
        
        /* Button Styles */
        .btn-action {
            background-color: #333;
            border: 1px solid #555;
            color: #fff;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.2s;
        }
        .btn-action:hover {
            background-color: #444;
            border-color: #76B900;
            color: #76B900;
        }
        .btn-action:active { transform: translateY(1px); }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col p-4 lg:p-6">

    <div class="container mx-auto max-w-[1400px] flex-grow">
        
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold nvidia-green">Interactive Bloch Sphere</h1>
            <p class="text-gray-300 mt-2 max-w-4xl mx-auto text-sm lg:text-base leading-relaxed">
                Visualizing the qubit state: <span class="text-white font-mono font-bold mx-1">\( |\psi\rangle = \alpha|0\rangle + \beta|1\rangle \)</span>
            </p>
            <p class="text-gray-300 text-xs mt-2 max-w-3xl mx-auto">
                <b>Born's Rule</b> tells us that the probability of measuring 
                state \(|0\rangle\) or \(|1\rangle\) is determined by the squared magnitude of the state's amplitudes.
            </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
            
            <div class="lg:col-span-4 space-y-5">
                
                <div class="info-box">
                    <h2 class="text-sm font-bold text-gray-300 uppercase tracking-wider mb-4 border-b border-gray-600 pb-2">State Parameters</h2>
                    
                    <div class="mb-5">
                        <div class="flex justify-between items-center mb-1">
                            <label class="font-bold text-white">Theta (\(\theta\))</label>
                            <span id="theta-value" class="font-mono text-xs nvidia-green bg-black px-2 py-0.5 rounded border border-gray-700">0.00 \(\pi\)</span>
                        </div>
                        <input id="theta-slider" type="range" min="0" max="3.14159" step="0.01" value="0">
                        <p class="text-[10px] text-gray-300 mt-1">
                            Controls the angle between the statevector and the z-axis.                       </p>
                    </div>

                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-1">
                            <label class="font-bold text-white">Phi (\(\phi\))</label>
                            <span id="phi-value" class="font-mono text-xs nvidia-green bg-black px-2 py-0.5 rounded border border-gray-700">0.00 \(\pi\)</span>
                        </div>
                        <input id="phi-slider" type="range" min="0" max="6.28318" step="0.01" value="0">
                        <p class="text-[10px] text-gray-300 mt-1">
                            Controls relative phase. Rotates around the z-axis, the axis containing \(|0\rangle\) and \(|1\rangle\).
                        </p>
                    </div>
                    <div class="border-t border-gray-600 pt-4">
                        <h3 class="text-xs font-bold text-gray-300 uppercase tracking-wider mb-3 text-center">Complex Amplitudes</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-black/40 p-2 rounded border border-gray-700 text-center">
                                <span class="block text-xs text-gray-300 font-bold mb-1">Alpha (\(\alpha\))</span>
                                <span id="alpha-value" class="font-mono text-white text-lg">1.00 + 0.00i</span>
                            </div>
                            <div class="bg-black/40 p-2 rounded border border-gray-700 text-center">
                                <span class="block text-xs text-gray-300 font-bold mb-1">Beta (\(\beta\))</span>
                                <span id="beta-value" class="font-mono text-white text-lg">0.00 + 0.00i</span>
                            </div>
                        </div>
                        <p class="text-xs text-center text-gray-300 mt-2">
                            \( |\psi\rangle = \alpha|0\rangle + \beta|1\rangle \)
                        </p>
                    </div>
                </div>

                <div class="info-box py-3">
                    <h2 class="text-xs font-bold text-gray-300 uppercase tracking-wider mb-3">Visualizing Measurement</h2>
                    <div class="flex flex-col gap-3">
                        
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-200">Show Probability Distribution</span>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="toggle-hist" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer" style="top: 2px; left: 2px; transition: all 0.3s;" />
                                <label for="toggle-hist" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-700 cursor-pointer"></label>
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-200">Simulate Measurement</span>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="toggle-exp" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer" style="top: 2px; left: 2px; transition: all 0.3s;" />
                                <label for="toggle-exp" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-700 cursor-pointer"></label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <h2 class="text-sm font-bold text-white uppercase tracking-wider mb-3 border-b border-gray-600 pb-2">How to Use</h2>
                    <ol class="list-decimal list-outside ml-4 space-y-3 text-xs text-gray-300 leading-relaxed">
                        <li>
                            <strong class="text-white">Set the State:</strong> Use the <b>Theta</b> and <b>Phi</b> sliders to set the quantum state.
                        <li>
                            <strong class="text-white">Visualize:</strong> Watch the <b>Bloch Sphere</b> to see the statevector's position and the <b>Amplitudes</b> box to see the quantum state's complex coefficients.
                        </li>
                        <li>
                            <strong class="text-white">Analyze:</strong> Enable the <b>Measurement Tools</b> above. Use the <i>Probability Distribution</i> to see the theoretical odds ( Rule) and <i>Simulate Measurement</i> to simulate actual quantum measurements ("shots").
                        </li>
                    </ol>
                </div>

            </div>

            <div class="lg:col-span-8 flex flex-col gap-6">
                
                <div class="info-box p-0 bg-black overflow-hidden relative min-h-[500px] lg:h-[500px]">
                    <div class="absolute top-4 left-4 z-10 pointer-events-none">
                        <h2 class="text-2xl font-semibold text-white/90">Bloch Sphere</h2>
                        <p class="text-xs text-gray-400">Geometric representation of the state vector</p>
                    </div>
                    
                    <div id="bloch-sphere-container" class="w-full h-full"></div>
                    
                    <div class="absolute bottom-4 right-4 bg-gray-900/80 p-2 rounded backdrop-blur-sm border border-gray-700 text-xs text-gray-300 pointer-events-none">
                        <div class="flex items-center gap-2"><div class="w-2 h-2 bg-[#76B900] rounded-full"></div> State Vector \(|\psi\rangle\)</div>
                    </div>
                </div>

                <div id="histogram-box" class="info-box h-64 flex-col transition-all duration-300" style="display: none;">
                    <h2 class="text-sm font-bold text-gray-300 uppercase tracking-wider mb-1 text-center">Measurement Probabilities</h2>
                    <p class="text-[10px] text-center text-gray-400 mb-2">Based on Born's Rule</p>
                    <div class="flex-grow relative border-b border-l border-gray-600 ml-2 mb-2">
                        <div class="absolute inset-0 flex flex-col justify-between pointer-events-none text-[10px] text-gray-500">
                            <div class="border-t border-gray-700 w-full h-0"><span class="-ml-6 relative -top-2">100%</span></div>
                            <div class="border-t border-gray-700 w-full h-0 border-dashed opacity-30"></div>
                            <div class="border-t border-gray-700 w-full h-0"><span class="-ml-6 relative -top-2">50%</span></div>
                            <div class="border-t border-gray-700 w-full h-0 border-dashed opacity-30"></div>
                            <div class="h-0"><span class="-ml-6 relative -top-2">0%</span></div>
                        </div>

                        <div class="absolute inset-0 flex items-end justify-around px-2 z-10">
                            <div class="w-16 flex flex-col justify-end items-center h-full group">
                                <span id="hist-val-0" class="font-mono font-bold text-xs mb-1 text-white">100%</span>
                                <div id="bar-0" class="hist-bar w-full bg-gradient-to-t from-blue-900 to-blue-500 rounded-t shadow-[0_0_10px_rgba(59,130,246,0.4)]" style="height: 100%;"></div>
                            </div>
                            <div class="w-16 flex flex-col justify-end items-center h-full group">
                                <span id="hist-val-1" class="font-mono font-bold text-xs mb-1 text-white">0%</span>
                                <div id="bar-1" class="hist-bar w-full bg-gradient-to-t from-blue-900 to-blue-500 rounded-t shadow-[0_0_10px_rgba(59,130,246,0.4)]" style="height: 0%;"></div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-around ml-2 text-base font-bold text-white">
                        <div class="w-16 text-center text-xs text-gray-400">P(|0⟩)<br><span class="text-[9px] opacity-60">Prob of 0</span></div>
                        <div class="w-16 text-center text-xs text-gray-400">P(|1⟩)<br><span class="text-[9px] opacity-60">Prob of 1</span></div>
                    </div>
                </div>

                <div id="experiment-box" class="info-box border-nvidia-green border-opacity-30 transition-all duration-300" style="display: none;">
                    <div class="flex flex-col mb-3">
                        <h3 class="text-sm font-bold text-white uppercase tracking-wider mb-1">Simulate Measurement</h3>
                        <p class="text-xs text-gray-300 leading-tight">
                            Measurement collapses the quantum state into computational basis states and produces a single classical state (\(0\) or \(1\)). 
                            <span class="text-white font-semibold block mt-1">Click the buttons repeatedly to observe statistical randomness.</span>
                        </p>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-2 mb-3">
                        <button onclick="measure(1)" class="btn-action">1 Shot</button>
                        <button onclick="measure(10)" class="btn-action">10 Shots</button>
                        <button onclick="measure(100)" class="btn-action">100 Shots</button>
                    </div>

                    <div id="simulation-output" class="bg-black/50 rounded p-3 min-h-[80px] flex flex-col justify-center items-center text-center relative overflow-hidden border border-gray-800">
                        <span class="text-gray-400 text-xs italic">Click a button to measure...</span>
                    </div>
                </div>

            </div>

        </div>
    </div>

    <script type="module">
        // --- Three.js Visualization Setup ---
        function createBlochSphere(container) {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(3.5, 2, 2.5);

            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            const group = new THREE.Group();
            scene.add(group);
            group.rotation.x = -Math.PI / 2; 

            // Sphere
            const sphereGeom = new THREE.SphereGeometry(1, 40, 40);
            const sphereMat = new THREE.MeshPhongMaterial({ 
                color: 0x151515, 
                transparent: true, 
                opacity: 0.1, 
                side: THREE.DoubleSide
            });
            const sphereWire = new THREE.MeshBasicMaterial({ color: 0x444444, wireframe: true, transparent: true, opacity: 0.2 });
            
            group.add(new THREE.Mesh(sphereGeom, sphereMat));
            group.add(new THREE.Mesh(sphereGeom, sphereWire));

            // Lighting
            scene.add(new THREE.AmbientLight(0xffffff, 0.4));
            const p1 = new THREE.PointLight(0xffffff, 0.8); p1.position.set(5, 5, 5); scene.add(p1);
            const p2 = new THREE.PointLight(0x76B900, 0.3); p2.position.set(-5, -5, 2); scene.add(p2);

            // State Vector
            const vectorGeom = new THREE.ArrowHelper(new THREE.Vector3(0, 0, 1), new THREE.Vector3(0, 0, 0), 1.05, 0x76B900, 0.15, 0.08);
            group.add(vectorGeom);
            
            // Axes Helper
            const axesGroup = new THREE.Group();
            const axisLength = 1.2;
            const axisColor = 0x666666;
            axesGroup.add(new THREE.ArrowHelper(new THREE.Vector3(1,0,0), new THREE.Vector3(0,0,0), axisLength, axisColor, 0.05, 0.03));
            axesGroup.add(new THREE.ArrowHelper(new THREE.Vector3(0,1,0), new THREE.Vector3(0,0,0), axisLength, axisColor, 0.05, 0.03));
            axesGroup.add(new THREE.ArrowHelper(new THREE.Vector3(0,0,1), new THREE.Vector3(0,0,0), axisLength, axisColor, 0.05, 0.03));
            group.add(axesGroup);

            // Labels
            const createLabel = (text, position) => {
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                context.font = `Bold 32px Inter`; 
                const textWidth = context.measureText(text).width;
                canvas.width = textWidth + 20;
                canvas.height = 40;
                context.font = `Bold 32px Inter`;
                context.fillStyle = "rgba(255, 255, 255, 0.9)";
                context.textAlign = 'center';
                context.textBaseline = 'middle';
                context.shadowColor = "rgba(0,0,0,1)";
                context.shadowBlur = 5;
                context.fillText(text, canvas.width / 2, canvas.height / 2);
                
                const texture = new THREE.CanvasTexture(canvas);
                const spriteMat = new THREE.SpriteMaterial({ map: texture, transparent: true });
                const sprite = new THREE.Sprite(spriteMat);
                sprite.scale.set(canvas.width / 90, canvas.height / 90, 1.0);
                sprite.position.copy(position);
                return sprite;
            };

            group.add(createLabel('|0⟩', new THREE.Vector3(0, 0, 1.3)));
            group.add(createLabel('|1⟩', new THREE.Vector3(0, 0, -1.3)));
            group.add(createLabel('|+⟩', new THREE.Vector3(1.3, 0, 0)));
            group.add(createLabel('|i⟩', new THREE.Vector3(0, 1.3, 0)));

            const onWindowResize = () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            };
            window.addEventListener('resize', onWindowResize);

            return { scene, camera, renderer, controls, vectorGeom, onWindowResize };
        }

        function updateVectorPosition(vector, theta, phi) {
            const x = Math.sin(theta) * Math.cos(phi);
            const y = Math.sin(theta) * Math.sin(phi);
            const z = Math.cos(theta);
            vector.setDirection(new THREE.Vector3(x, y, z).normalize());
        }
        
        // --- Main Logic ---
        const blochSphereViz = createBlochSphere(document.getElementById('bloch-sphere-container'));
        
        const sliderTheta = document.getElementById('theta-slider');
        const sliderPhi = document.getElementById('phi-slider');
        const valueTheta = document.getElementById('theta-value');
        const valuePhi = document.getElementById('phi-value');
        const valueAlpha = document.getElementById('alpha-value');
        const valueBeta = document.getElementById('beta-value');
        const bar0 = document.getElementById('bar-0');
        const bar1 = document.getElementById('bar-1');
        const histVal0 = document.getElementById('hist-val-0');
        const histVal1 = document.getElementById('hist-val-1');
        const outputDiv = document.getElementById('simulation-output');

        // Toggle Logic
        const toggleHist = document.getElementById('toggle-hist');
        const toggleExp = document.getElementById('toggle-exp');
        const boxHist = document.getElementById('histogram-box');
        const boxExp = document.getElementById('experiment-box');

        toggleHist.addEventListener('change', (e) => {
            boxHist.style.display = e.target.checked ? 'flex' : 'none';
        });
        toggleExp.addEventListener('change', (e) => {
            boxExp.style.display = e.target.checked ? 'block' : 'none';
        });

        let currentProb0 = 1.0;

        function formatComplex(c) {
            const sign = c.im < 0 ? "-" : "+";
            return `${c.re.toFixed(3)} ${sign} ${Math.abs(c.im).toFixed(3)}i`;
        }
        
        function updateAll() {
            const theta = parseFloat(sliderTheta.value);
            const phi = parseFloat(sliderPhi.value);

            valueTheta.textContent = (theta / Math.PI).toFixed(2) + " π";
            valuePhi.textContent = (phi / Math.PI).toFixed(2) + " π";
            
            const alpha = { re: Math.cos(theta / 2), im: 0 };
            const beta = { re: Math.cos(phi) * Math.sin(theta / 2), im: Math.sin(phi) * Math.sin(theta / 2) };

            const prob0 = (alpha.re * alpha.re + alpha.im * alpha.im);
            const prob1 = (beta.re * beta.re + beta.im * beta.im);
            currentProb0 = prob0;
            
            const pct0 = (prob0 * 100);
            const pct1 = (prob1 * 100);

            valueAlpha.textContent = formatComplex(alpha);
            valueBeta.textContent = formatComplex(beta);
            
            bar0.style.height = `${pct0}%`;
            bar1.style.height = `${pct1}%`;
            histVal0.textContent = `${pct0.toFixed(1)}%`;
            histVal1.textContent = `${pct1.toFixed(1)}%`;
            
            updateVectorPosition(blochSphereViz.vectorGeom, theta, phi);
        }

        window.measure = function(shots) {
            const results = [];
            let count0 = 0;
            let count1 = 0;

            for(let i=0; i<shots; i++) {
                const r = Math.random();
                const outcome = r < currentProb0 ? 0 : 1;
                results.push(outcome);
                if(outcome === 0) count0++; else count1++;
            }

            outputDiv.innerHTML = ''; 

            if (shots === 1) {
                const val = results[0];
                const colorClass = val === 0 ? 'text-[#76B900]' : 'text-blue-500';
                const label = val === 0 ? '0' : '1';
                const subLabel = val === 0 ? 'from State |0⟩' : 'from State |1⟩';
                
                outputDiv.innerHTML = `
                    <div class="flex flex-col items-center animate-pulse">
                        <span class="text-[10px] uppercase tracking-widest text-gray-400 mb-1">Measured Result</span>
                        <span class="text-4xl font-bold ${colorClass}">${label}</span>
                        <span class="text-[10px] text-gray-500 mt-1">${subLabel}</span>
                    </div>
                `;
            } else {
                const pct0 = ((count0 / shots) * 100).toFixed(0);
                const pct1 = ((count1 / shots) * 100).toFixed(0);
                
                const summary = document.createElement('div');
                summary.className = "w-full flex justify-between text-xs font-bold mb-2 border-b border-gray-700 pb-1";
                summary.innerHTML = `
                    <span class="text-[#76B900]">0s: ${count0} (${pct0}%)</span>
                    <span class="text-blue-500">1s: ${count1} (${pct1}%)</span>
                `;
                outputDiv.appendChild(summary);

                const streamContainer = document.createElement('div');
                streamContainer.className = "w-full grid grid-cols-10 gap-1 text-center font-mono text-[10px] max-h-16 overflow-y-auto scrollbar-hide";
                results.forEach((res, index) => {
                    const span = document.createElement('span');
                    span.textContent = res;
                    span.className = res === 0 ? 'text-[#76B900] bit-result' : 'text-blue-500 bit-result';
                    span.style.animationDelay = `${Math.min(index * 0.01, 1)}s`; 
                    streamContainer.appendChild(span);
                });
                outputDiv.appendChild(streamContainer);
            }
        };

        function animate() {
            requestAnimationFrame(animate);
            blochSphereViz.controls.update();
            blochSphereViz.renderer.render(blochSphereViz.scene, blochSphereViz.camera);
        }

        [sliderTheta, sliderPhi].forEach(slider => {
            slider.addEventListener('input', updateAll);
        });
        
        updateAll();
        animate();
        setTimeout(() => { blochSphereViz.onWindowResize(); }, 100);

    </script>
</body>
</html>
